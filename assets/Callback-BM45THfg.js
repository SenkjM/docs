import{a as h}from"./index-CmmzNXUp.js";import{d as N,j as T,b as s,u as e,o as n,e as p,h as i,t as l,i as a,g as x,f as C,N as g,a0 as v}from"./app-Dr385GFQ.js";import{N as y}from"./Alert-C2hF9rwd.js";import{N as M}from"./Input-B0IhrA8Q.js";import{_ as P}from"./plugin-vue_export-helper-DlAUqK2U.js";const S=N({__name:"Callback",setup(w){const _=`${location.origin}/tool/dropbox/callback`,c=new URL(window.location.href),d=c.searchParams.get("code"),f=c.searchParams.get("state"),u=c.searchParams.get("error"),b=c.searchParams.get("error_description"),[k,m]=atob(f).split("::"),r=T({refreshToken:"",accessToken:"",error1:"",errorMessage1:""});return d&&f&&!u&&(()=>{fetch(`${h()}/alist/dropbox/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d,client_id:k,client_secret:m,grant_type:"authorization_code",redirect_uri:_})}).then(t=>t.json()).then(t=>{if(console.log(t),t.error){r.error1=t.error,r.errorMessage1=t.error_description;return}r.refreshToken=t.refresh_token,r.accessToken=t.access_token})})(),(t,o)=>!e(d)||!e(f)||e(u)?(n(),s(e(y),{key:0,title:e(u)||"Error",type:"error"},{default:p(()=>[i(l(e(b)),1)]),_:1},8,["title"])):(n(),s(e(g),{key:1,vertical:"",size:"large"},{default:p(()=>[a("p",null,[o[0]||(o[0]=a("b",null,"client_id: ",-1)),i(l(e(k)),1)]),a("p",null,[o[1]||(o[1]=a("b",null,"client_secret: ",-1)),i(l(e(m)),1)]),a("p",null,[o[2]||(o[2]=a("b",null,"redirect_uri: ",-1)),i(l(_))]),r.error1||r.errorMessage1?(n(),s(e(y),{key:0,title:r.error1,type:"error"},{default:p(()=>[i(l(r.errorMessage1),1)]),_:1},8,["title"])):x("",!0),C(e(g),{vertical:""},{default:p(()=>[o[3]||(o[3]=a("b",null,"refresh_token:",-1)),!r.refreshToken&&!r.errorMessage1?(n(),s(e(v),{key:0})):(n(),s(e(M),{key:1,type:"textarea",autosize:"",readonly:"",value:r.refreshToken},null,8,["value"]))]),_:1,__:[3]})]),_:1}))}}),$=P(S,[["__scopeId","data-v-39f0fed5"]]);export{$ as C};
